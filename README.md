# 第二次培训任务

## 项目概述

本项目旨在实现对输入图像的多种处理操作，包括颜色空间转换、滤波、边缘检测、轮廓提取与筛选、图像旋转与裁剪等。通过 OpenCV 库实现对图像中特定目标（如红色区域和数字形状的装甲板）的检测与识别。

## 开发环境

- **操作系统**：Ubuntu22.04.6
- **编程语言**：C++11
- **开发库**：OpenCV4.9.0

## 文件结构

```
opencv_project/
├── CMakeLists.txt
├── src/
│   └── main.cpp
│   └── second_main.cpp
├── README.md
├── resources/
│   └── result_img
│       └── 1_gray.png
│       └── 2_hsv.png
│       .
│       .
│       .
│       └── 13_drawing.png
│   └── result_img_second
│       └── 1_hsv.pmg
│       └── 9_bright_binary.png
│       .
│       .
│       .
│       └── 17_lunkuoshaixuan.png
│   └── test_image.png
│   └── test_image_1.png
└── build/
```

## 实现功能

### 1. 图像读取与显示

读取输入图像并进行灰度化处理，降低计算复杂度，为后续处理做准备。

### 2. 颜色空间转换

将图像从 BGR 色彩空间转换到 HSV 色彩空间，以便进行颜色过滤。

### 3. 图像滤波

应用均值滤波、高斯滤波和中值滤波，去除图像噪声，平滑图像。

### 4. 提取红色区域

根据 HSV 色彩范围提取红色区域，生成红色掩码。

### 5. 轮廓提取

在红色掩码上查找轮廓，提取图像中的目标区域。

### 6. 轮廓筛选与绘制

根据轮廓面积和长宽比筛选出符合目标特征的轮廓，并在原图上绘制红色矩形框标识目标区域。

### 7. 高亮区域处理

对图像进行二值化处理，提取高亮区域，并进行形态学开运算去除噪点。

### 8. 图像旋转与裁剪

将图像旋转 35 度，并裁剪出图像的左上角 1/4 区域。

### 9. 图像绘制

在图像上绘制圆形、矩形和文字，展示图像处理结果。

## 使用方法

1. **安装依赖**

确保已安装 OpenCV 库和 C++ 开发环境。

2. **编译项目**

使用以下命令编译项目：

```bash
g++ -o image_processor main.cpp `pkg-config --cflags --libs opencv4`
```

3. **运行程序**

运行编译后的程序：

```bash
./image_processor
```

4. **查看结果**

处理后的图像将保存在指定的输出目录中，并在屏幕上显示。

## 调试与优化

在开发过程中，对代码进行了多次调试和优化：

- **轮廓提取问题**：初期发现提取的轮廓数量过多，包含大量噪声轮廓。通过调整二值化阈值和形态学操作参数，减少噪声干扰。
- **匹配度问题**：模板匹配初期效果不佳，匹配度较低。通过调整模板形状和匹配算法参数，提高匹配精度。
- **轮廓筛选**：通过调整面积和长宽比的筛选阈值，更好地适应目标轮廓的特征。

# 实际应用

## 一、任务概述
本任务旨在通过OpenCV库对图像进行处理，实现对特定目标（如数字“4”形状的装甲板）的检测与识别。主要操作包括图像读取、灰度转换、边缘检测、轮廓提取、筛选及绘制。

## 二、开发过程

### （一）环境配置与图像读取
1. 配置开发环境，安装OpenCV库及C++开发工具。
2. 编写代码以支持从命令行读取图像路径，或使用默认路径读取测试图像。通过`cv::imread`函数读取图像，并检查图像是否成功加载。

### （二）图像预处理
1. 将图像转换为灰度图，以降低计算复杂度，使用`cv::cvtColor`函数完成颜色空间转换。
2. 对灰度图进行二值化处理，使用`cv::threshold`函数将图像转换为黑白二值图，以便后续处理。

### （三）边缘检测与形态学操作
1. 应用Canny算法进行边缘检测，使用`cv::Canny`函数提取图像中的边缘。
2. 执行形态学开运算，利用`cv::morphologyEx`函数去除小噪点，平滑边缘。

### （四）轮廓提取与初步筛选
1. 使用`cv::findContours`函数查找图像中的所有轮廓。
2. 计算每个轮廓的面积和长宽比，初步筛选出面积和长宽比符合目标特征的轮廓。

### （五）轮廓筛选与匹配
1. **基于面积和长宽比筛选**：设定面积范围（2000至6000）和长宽比范围（0.75至1），过滤掉不符合条件的轮廓。
2. **轮廓匹配**：创建一个形状为“4”的模板轮廓，使用`cv::matchShapes`函数计算检测到的轮廓与模板轮廓的匹配度，找出最匹配的轮廓。

### （六）结果绘制与保存
1. 在原图上绘制出最匹配的轮廓及其外接矩形，使用`cv::drawContours`和`cv::rectangle`函数。
2. 保存处理后的图像结果，并显示在窗口中。

## 三、调试与优化

### （一）调试过程
1. **轮廓提取问题**：初期发现提取的轮廓数量过多，包含大量噪声轮廓。通过调整二值化阈值和形态学操作参数，减少噪声干扰。
2. **匹配度问题**：模板匹配初期效果不佳，匹配度较低。通过调整模板形状和匹配算法参数，提高匹配精度。

### （二）优化措施
1. 调整面积和长宽比的筛选阈值，以更好地适应目标轮廓的特征。
2. 对模板轮廓进行优化，使其更接近实际目标形状。
3. 结合多种轮廓特征（如面积、长宽比、形状匹配度等）进行综合筛选，提高筛选的准确性。

## 四、结论
通过上述开发过程，成功实现了对图像中特定目标（带有数字“4”的装甲板）的检测与识别。实验结果表明，该方法能够有效提取目标轮廓，并在图像中准确绘制出目标位置。
